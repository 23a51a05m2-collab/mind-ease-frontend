<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MindEase - Your Private Mental Health Support</title>
    
    <!-- 
      ========================================
      INTERNAL CSS (STYLES)
      ========================================
    -->
    <style>
        /* === 1. Global & Root Variables === */
        :root {
            --primary-color: #4A90E2; /* Calming Blue */
            --secondary-color: #50C878; /* Hopeful Green */
            --dark-text: #333;
            --light-text: #f9f9f9;
            --bg-color: #f4f7f6;
            --container-bg: #ffffff;
            --border-radius: 8px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            background-color: var(--bg-color);
            color: var(--dark-text);
        }

        /* === 2. Layout & Reusable Classes === */
        .container {
            width: 90%;
            max-width: 1100px;
            margin: 0 auto;
            padding: 20px 0;
        }

        section {
            padding: 80px 20px;
            animation: fadeIn 1s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1, h2, h3 {
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--primary-color);
        }

        h1 { font-size: 2.8rem; }
        h2 { font-size: 2.2rem; text-align: center; }
        p { margin-bottom: 15px; }

        .btn {
            display: inline-block;
            padding: 12px 25px;
            font-size: 1rem;
            font-weight: 600;
            text-decoration: none;
            color: var(--container-bg);
            background-color: var(--secondary-color);
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        .btn:hover {
            background-color: #45a062;
            transform: translateY(-2px);
        }

        .btn-primary {
            background-color: var(--primary-color);
        }
        .btn-primary:hover {
            background-color: #3a7ac8;
        }
        
        .btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        /* === 3. Header & Navigation === */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            position: sticky;
            top: 0;
            background-color: var(--container-bg);
            z-index: 100;
            box-shadow: var(--shadow);
        }

        .navbar .logo {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-color);
            text-decoration: none;
        }
        
        .navbar .logo span {
            color: var(--secondary-color);
        }

        .nav-links {
            display: flex;
            list-style: none;
        }

        .nav-links li {
            margin-left: 30px;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--dark-text);
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .nav-links a:hover {
            color: var(--primary-color);
        }

        /* === 4. Hero Section === */
        #hero {
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            min-height: 90vh;
            /* NO-IMAGE VERSION: Using a soft gradient */
            background: linear-gradient(135deg, #e0f7fa 0%, #b3e5fc 100%);
            color: var(--dark-text);
        }

        #hero .hero-content {
            max-width: 800px;
        }

        #hero h1 {
            color: var(--dark-text);
            font-size: 3.5rem;
            margin-bottom: 10px;
        }

        #hero p {
            font-size: 1.2rem;
            margin-bottom: 30px;
        }

        /* === 5. Features Section === */
        #features {
            background-color: var(--container-bg);
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .feature-card {
            background: var(--bg-color);
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .feature-card .icon {
            font-size: 3rem; /* Emoji as placeholder icon */
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .feature-card h3 {
             color: var(--secondary-color);
        }

        /* === 6. Why-Us Section (No Image) === */
        #why-us .content {
            max-width: 900px;
            margin: 0 auto;
            text-align: center;
        }

        #why-us h2 {
            text-align: center;
        }

        #why-us ul {
            list-style: none;
            margin-top: 30px;
            display: inline-block;
            text-align: left;
        }

        #why-us li {
            font-size: 1.1rem;
            margin-bottom: 15px;
            position: relative;
            padding-left: 35px;
        }
        
        /* Custom checkmark icon */
        #why-us li::before {
            content: 'âœ“';
            color: var(--secondary-color);
            font-weight: bold;
            font-size: 1.2rem;
            position: absolute;
            left: 0;
            top: 0;
        }

        /* === 7. Tools Section === */
        #tools {
            background-color: var(--container-bg);
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }

        .tool-card {
            padding: 25px;
            border: 2px solid var(--bg-color);
            border-radius: var(--border-radius);
            transition: border-color 0.3s ease;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .tool-card:hover {
            border-color: var(--primary-color);
        }
        
        .tool-card h3 {
            color: var(--primary-color);
        }
        
        .tool-card .btn {
            margin-top: 15px;
        }

        /* === 8. CTA Section === */
        #cta {
            background: var(--primary-color);
            color: var(--light-text);
            text-align: center;
        }
        
        #cta h2 {
            color: var(--light-text);
        }

        #cta p {
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto 30px auto;
        }

        /* === 9. Footer === */
        footer {
            background-color: var(--dark-text);
            color: var(--light-text);
            text-align: center;
            padding: 40px 20px;
        }
        
        footer p {
            margin: 0;
        }

        footer .footer-links {
            list-style: none;
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        footer .footer-links a {
            color: var(--light-text);
            text-decoration: none;
        }
        footer .footer-links a:hover {
            text-decoration: underline;
        }

        /* === 10. Modal (Popup) Styles === */
        .modal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.6);
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background-color: var(--container-bg);
            margin: 8% auto;
            width: 90%;
            max-width: 600px; /* Increased max-width for tools */
            border-radius: var(--border-radius);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        /* Chat modal needs to be smaller */
        #chatModal .modal-content {
            max-width: 500px;
            margin: 10% auto;
        }

        .modal-header {
            padding: 15px 25px;
            background-color: var(--primary-color);
            color: var(--light-text);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            color: var(--light-text);
            margin: 0;
        }

        .close-btn {
            color: var(--light-text);
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close-btn:hover {
            color: #ddd;
        }

        .modal-body {
            padding: 25px;
            flex-grow: 1;
            line-height: 1.7;
        }
        
        /* --- 10a. Chat Modal --- */
        .chat-window {
            height: 300px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            padding: 15px;
            overflow-y: auto;
            margin-bottom: 15px;
            background: var(--bg-color);
            display: flex;
            flex-direction: column;
        }

        .chat-message {
            padding: 10px 14px;
            border-radius: var(--border-radius);
            margin-bottom: 10px;
            max-width: 80%;
            line-height: 1.4;
        }

        .chat-message.user {
            background-color: var(--primary-color);
            color: var(--light-text);
            margin-left: auto;
            align-self: flex-end;
        }

        .chat-message.ai {
            background-color: #e4e4e4;
            color: var(--dark-text);
            margin-right: auto;
            align-self: flex-start;
        }
        
        .chat-message.typing {
            background-color: #e4e4e4;
            color: #777;
            font-style: italic;
            margin-right: auto;
            align-self: flex-start;
        }
        
        .chat-message.error {
            background-color: #ffebee;
            color: #c62828;
            margin-right: auto;
            align-self: flex-start;
        }

        .chat-input-area {
            display: flex;
            gap: 10px;
        }
        
        #chatInput {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: var(--border-radius);
            font-size: 1rem;
        }
        
        #sendChatBtn {
            padding: 0 20px;
        }

        /* --- 10b. Breathing Tool --- */
        #breathing-tool {
            text-align: center;
        }
        .breathing-circle {
            width: 200px;
            height: 200px;
            background-color: var(--primary-color);
            border-radius: 50%;
            margin: 30px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--light-text);
            font-size: 1.5rem;
            font-weight: 600;
            transition: transform 4s ease-in-out;
        }
        .breathing-circle.grow {
            transform: scale(1.5);
        }
        .breathing-circle.shrink {
            transform: scale(1);
        }
        #breathing-instruction {
            font-size: 1.2rem;
            font-weight: 500;
            min-height: 2em;
        }
        
        /* --- 10c. Quiz Tool --- */
        .quiz-question {
            margin-bottom: 20px;
        }
        .quiz-question p {
            font-weight: 600;
            margin-bottom: 10px;
        }
        .quiz-question label {
            display: block;
            margin-bottom: 8px;
            cursor: pointer;
        }
        #quiz-results {
            display: none;
            margin-top: 25px;
            padding: 20px;
            background: var(--bg-color);
            border-radius: var(--border-radius);
        }
        
        /* --- 10d. Journal Tool --- */
        #journal-entry {
            width: 100%;
            height: 200px;
            padding: 15px;
            font-family: inherit;
            font-size: 1rem;
            border: 1px solid #ccc;
            border-radius: var(--border-radius);
            resize: vertical;
        }
        #journal-status {
            display: none;
            margin-top: 15px;
            font-weight: 600;
            color: var(--secondary-color);
        }
        
        /* --- 10e. Article Tool --- */
        #article-tool h4 {
            font-size: 1.2rem;
            color: var(--secondary-color);
            margin-bottom: 15px;
        }
        #article-tool p {
            margin-bottom: 15px;
        }

    </style>
</head>
<body>

    <!-- ========================================
         HTML CONTENT (STRUCTURE)
         ======================================== -->

    <!-- === HEADER & NAVIGATION === -->
    <header>
        <nav class="navbar">
            <div class="container">
                <a href="#hero" class="logo">Mind<span>Ease</span></a>
                <ul class="nav-links">
                    <li><a href="#features">How It Works</a></li>
                    <li><a href="#why-us">Why Us</a></li>
                    <li><a href="#tools">Resources</a></li>
                    <li><a href="#cta" class="btn btn-primary" data-modal-target="chatModal">Start Chat</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <main>

        <!-- === HERO SECTION === -->
        <section id="hero">
            <div class="hero-content container">
                <h1>Find Your Calm. Anytime, Anywhere.</h1>
                <p>Welcome to MindEase. Private, anonymous, and judgment-free mental health support for India. You are not alone.</p>
                <button class="btn btn-primary" data-modal-target="chatModal">Talk to our AI Guide</button>
            </div>
        </section>

        <!-- === FEATURES SECTION === -->
        <section id="features">
            <div class="container">
                <h2>How MindEase Supports You</h2>
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="icon">ðŸ’¬</div> <!-- Emoji as placeholder icon -->
                        <h3>24/7 AI Chat</h3>
                        <p>Talk to our caring AI chatbot anytime. It's trained to listen, provide coping strategies, and offer support, 100% anonymously.</p>
                    </div>
                    <div class="feature-card">
                        <div class="icon">ðŸ“š</div> <!-- Emoji as placeholder icon -->
                        <h3>Resource Library</h3>
                        <p>Access guided meditations, articles, and self-help tools curated by experts to help you understand and manage your feelings.</p>
                    </div>
                    <div class="feature-card">
                        <div class="icon">ðŸ”’</div> <!-- Emoji as placeholder icon -->
                        <h3>Mood Tracker</h3>
                        <p>Privately log your emotions and identify patterns. Understand your triggers and celebrate your progress over time.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- === WHY-US SECTION === -->
        <section id="why-us">
            <div class="container">
                <div class="content">
                    <h2>Built for India. Built for You.</h2>
                    <p>We understand the unique challenges you face. MindEase is designed to break down barriers of stigma and accessibility.</p>
                    <ul>
                        <li><strong>Completely Private:</strong> Your conversations are anonymous. No names, no records.</li>
                        <li><strong>Always Accessible:</strong> Get instant support 24/7, right from your phone. No appointments needed.</li>
                        <li><strong>No Judgment Zone:</strong> A safe space to express yourself freely and be heard.</li>
                        <li><strong>Scalable Support:</strong> We provide a reliable first step for everyone, reducing the load on overwhelmed services.</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- === TOOLS SECTION === -->
        <section id="tools">
            <div class="container">
                <h2>Quick Tools for Immediate Relief</h2>
                <div class="tools-grid">
                    <div class="tool-card">
                        <h3>Breathing Exercise</h3>
                        <p>A simple 5-minute guided exercise to calm your mind.</p>
                        <button class="btn btn-primary" data-modal-target="breathingModal">Try Now</button>
                    </div>
                    <div class="tool-card">
                        <h3>Self-Assessment</h3>
                        <p>A private quiz to help you understand your stress levels.</p>
                        <button class="btn btn-primary" data-modal-target="quizModal">Start Quiz</button>
                    </div>
                    <div class="tool-card">
                        <h3>Positive Journal</h3>
                        <p>Log three good things that happened today.</p>
                        <button class="btn btn-primary" data-modal-target="journalModal">Write Entry</button>
                    </div>
                    <div class="tool-card">
                        <h3>Learn About Stigma</h3>
                        <p>Read our article on overcoming the fear of seeking help.</p>
                        <button class="btn btn-primary" data-modal-target="articleModal">Read More</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- === CALL TO ACTION (CTA) SECTION === -->
        <section id="cta">
            <div class="container">
                <h2>Your Journey to Wellbeing Starts Here</h2>
                <p>You don't have to face this alone. Our AI guide is ready to listen, support, and help you find the resources you need. It's free, private, and available now.</p>
                <button class="btn" data-modal-target="chatModal">Start Your First Conversation</button>
            </div>
        </section>

    </main>

    <!-- === FOOTER === -->
    <footer>
        <div class="container">
            <ul class="footer-links">
                <li><a href="#">Privacy Policy</a></li>
                <li><a href="#">Terms of Service</a></li>
                <li><a href="#">Disclaimer</a></li>
            </ul>
            <p>&copy; 2025 MindEase. All rights reserved.</p>
            <p style="font-size: 0.8rem; margin-top: 10px;"><strong>Disclaimer:</strong> MindEase is an AI support tool and not a replacement for professional medical advice, diagnosis, or treatment. If you are in crisis, please contact a local emergency service.</p>
        </div>
    </footer>

    <!-- ========================================
         MODAL (POPUP) HTML
         ======================================== -->
    
    <!-- === CHAT MODAL === -->
    <div id="chatModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>MindEase AI Guide</h3>
                <span class="close-btn">&times;</span>
            </div>
            <div class="modal-body">
                <div class="chat-window" id="chatWindow">
                    <div class="chat-message ai">
                        Hi! I'm the MindEase guide. I'm here to listen. How are you feeling today?
                    </div>
                </div>
                <div class="chat-input-area">
                    <input type="text" id="chatInput" placeholder="Type your message...">
                    <button class="btn btn-primary" id="sendChatBtn">Send</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- === BREATHING MODAL === -->
    <div id="breathingModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Breathing Exercise</h3>
                <span class="close-btn">&times;</span>
            </div>
            <div class="modal-body">
                <div id="breathing-tool">
                    <p>Follow the circle and text. Let's begin.</p>
                    <div class="breathing-circle" id="breathing-circle"></div>
                    <p id="breathing-instruction">Get ready...</p>
                    <button class="btn" id="startBreathingBtn">Start</button>
                    <button class="btn" id="stopBreathingBtn" style="display:none; background-color: #aaa;">Stop</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- === QUIZ MODAL === -->
    <div id="quizModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Stress Self-Assessment</h3>
                <span class="close-btn">&times;</span>
            </div>
            <div class="modal-body">
                <p>Over the last 2 weeks, how often have you been bothered by the following?</p>
                <form id="quiz-form">
                    <div class="quiz-question">
                        <p>1. Feeling nervous, anxious, or on edge?</p>
                        <label><input type="radio" name="q1" value="0" required> Not at all</label>
                        <label><input type="radio" name="q1" value="1"> Several days</label>
                        <label><input type="radio" name="q1" value="2"> More than half the days</label>
                        <label><input type="radio" name="q1" value="3"> Nearly every day</label>
                    </div>
                    <div class="quiz-question">
                        <p>2. Not being able to stop or control worrying?</p>
                        <label><input type="radio" name="q2" value="0" required> Not at all</label>
                        <label><input type="radio" name="q2" value="1"> Several days</label>
                        <label><input type="radio" name="q2" value="2"> More than half the days</label>
                        <label><input type="radio" name="q2" value="3"> Nearly every day</label>
                    </div>
                    <div class="quiz-question">
                        <p>3. Feeling overwhelmed or that you can't cope?</p>
                        <label><input type="radio" name="q3" value="0" required> Not at all</label>
                        <label><input type="radio" name="q3" value="1"> Several days</label>
                        <label><input type="radio" name="q3" value="2"> More than half the days</label>
                        <label><input type="radio" name="q3" value="3"> Nearly every day</label>
                    </div>
                    <button type="submit" class="btn btn-primary">See Results</button>
                </form>
                <div id="quiz-results">
                    <h4>Your Results:</h4>
                    <p id="quiz-score-text"></p>
                    <p id="quiz-feedback-text"></p>
                    <p><small>This is not a medical diagnosis. It's a tool to help you reflect.</small></p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- === JOURNAL MODAL === -->
    <div id="journalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Positive Journal</h3>
                <span class="close-btn">&times;</span>
            </div>
            <div class="modal-body">
                <p>Write down three good things that happened today, no matter how small. This is saved privately in your browser.</p>
                <textarea id="journal-entry" placeholder="1. ...&#10;2. ...&#10;3. ..."></textarea>
                <button class="btn btn-primary" id="saveJournalBtn">Save Entry</button>
                <span id="journal-status">Saved!</span>
            </div>
        </div>
    </div>
    
    <!-- === ARTICLE MODAL === -->
    <div id="articleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Overcoming Stigma</h3>
                <span class="close-btn">&times;</span>
            </div>
            <div class="modal-body" id="article-tool">
                <h4>It's Okay to Not Be Okay</h4>
                <p>In India, talking about mental health can be difficult. Many worry about being judged by family, friends, or colleagues. This fear is called "stigma," and it's one of the biggest reasons people don't seek help.</p>
                
                <h4>Your Feelings Are Valid</h4>
                <p>Feeling sad, anxious, or overwhelmed is a human experience, just like feeling physically sick. It is not a sign of weakness or a personal failure. It's a sign that you are carrying a heavy load, and you deserve support.</p>
                
                <h4>Seeking Help is a Sign of Strength</h4>
                <p>Recognizing that you need support and taking a step to find it is one of the bravest things you can do. It's an act of self-care and self-preservation. Using a tool like MindEase is a powerful, private first step. You are not alone in this feeling, and you are not alone in seeking help.</p>
            </div>
        </div>
    </div>

    <!-- 
      ========================================
      INTERNAL JAVASCRIPT (FUNCTIONALITY)
      ========================================
    -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {

            // --- 1. NEW: Universal Modal Opening/Closing Logic ---
            const allModals = document.querySelectorAll('.modal');
            const openModalButtons = document.querySelectorAll('[data-modal-target]');
            const closeModalButtons = document.querySelectorAll('.close-btn');

            // Open modal function
            openModalButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const modalId = button.getAttribute('data-modal-target');
                    const modal = document.getElementById(modalId);
                    if (modal) {
                        modal.style.display = 'block';
                        // Special triggers for when modals open
                        if (modalId === 'breathingModal') resetBreathingTool();
                        if (modalId === 'quizModal') resetQuiz();
                        if (modalId === 'journalModal') loadJournalEntry();
                    }
                });
            });

            // Close modal function
            function closeModal(modal) {
                modal.style.display = 'none';
                // Special triggers for when modals close
                if (modal.id === 'breathingModal') stopBreathingTool();
            }

            closeModalButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const modal = button.closest('.modal');
                    closeModal(modal);
                });
            });

            // Close modal when clicking outside of it
            window.addEventListener('click', function(event) {
                allModals.forEach(modal => {
                    if (event.target === modal) {
                        closeModal(modal);
                    }
                });
            });


            // --- 2. NEW: Backend-Connected Chat Functionality ---
            
            const chatWindow = document.getElementById('chatWindow');
            const chatInput = document.getElementById('chatInput');
            const sendBtn = document.getElementById('sendChatBtn');
            const backendUrl = 'http://127.0.0.1:5000/chat'; // This is your Python server!

            // Handle sending a message
            async function sendMessage() {
                const messageText = chatInput.value.trim();
                if (messageText === '') return;

                // 1. Display user's message
                displayMessage(messageText, 'user');
                chatInput.value = '';
                sendBtn.disabled = true; // Disable button while bot replies

                // 2. Display "typing..." message
                const typingIndicator = displayMessage('typing...', 'typing');

                try {
                    // 3. Send message to Python backend
                    const response = await fetch('https://mind-ease-backend-7v6o.onrender.com', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ message: messageText })
                    });

                    // 4. Handle response from backend
                    chatWindow.removeChild(typingIndicator); // Remove "typing..."

                    if (!response.ok) {
                        // Handle server errors (e.g., if Python server is down)
                        throw new Error(`Server error: ${response.statusText}`);
                    }

                    const data = await response.json();
                    
                    if (data.response) {
                        displayMessage(data.response, 'ai');
                    } else {
                        throw new Error("Invalid response from server.");
                    }

                } catch (error) {
                    console.error("Fetch Error:", error);
                    // Display an error in the chat window
                    chatWindow.removeChild(typingIndicator);
                    displayMessage(`Error: Could not connect to the server. Please ensure the Python server is running. (${error.message})`, 'error');
                } finally {
                    sendBtn.disabled = false; // Re-enable button
                }
            }

            // Add event listener for Send button
            sendBtn.addEventListener('click', sendMessage);

            // Add event listener for 'Enter' key
            chatInput.addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    sendMessage();
                }
            });

            // Function to display a message in the chat window
            function displayMessage(message, sender) {
                const messageElement = document.createElement('div');
                messageElement.className = `chat-message ${sender}`;
                messageElement.textContent = message;
                
                chatWindow.appendChild(messageElement);
                chatWindow.scrollTop = chatWindow.scrollHeight;
                return messageElement; // Return for modification (e.g., removing 'typing')
            }


            // --- 3. Breathing Tool Logic ---
            const breathingCircle = document.getElementById('breathing-circle');
            const breathingInstruction = document.getElementById('breathing-instruction');
            const startBreathingBtn = document.getElementById('startBreathingBtn');
            const stopBreathingBtn = document.getElementById('stopBreathingBtn');
            let breathingInterval = null;

            startBreathingBtn.addEventListener('click', () => {
                startBreathingBtn.style.display = 'none';
                stopBreathingBtn.style.display = 'inline-block';
                runBreathingCycle();
            });
            
            stopBreathingBtn.addEventListener('click', () => {
                stopBreathingTool();
                resetBreathingTool();
            });
            
            function resetBreathingTool() {
                startBreathingBtn.style.display = 'inline-block';
                stopBreathingBtn.style.display = 'none';
                breathingInstruction.textContent = 'Get ready...';
                breathingCircle.classList.remove('grow', 'shrink');
            }

            function stopBreathingTool() {
                if (breathingInterval) {
                    clearInterval(breathingInterval);
                    breathingInterval = null;
                }
            }

            function runBreathingCycle() {
                // 1. Initial Inhale
                breathingInstruction.textContent = 'Breathe In...';
                breathingCircle.classList.add('grow');
                
                // 2. Hold
                setTimeout(() => {
                    breathingInstruction.textContent = 'Hold...';
                }, 4000); // 4s inhale

                // 3. Exhale
                setTimeout(() => {
                    breathingInstruction.textContent = 'Breathe Out...';
                    breathingCircle.classList.remove('grow');
                }, 7000); // 3s hold (4+3)

                // 4. Repeat
                breathingInterval = setInterval(() => {
                    breathingInstruction.textContent = 'Breathe In...';
                    breathingCircle.classList.add('grow');
                    
                    setTimeout(() => {
                        breathingInstruction.textContent = 'Hold...';
                    }, 4000);

                    setTimeout(() => {
                        breathingInstruction.textContent = 'Breathe Out...';
                        breathingCircle.classList.remove('grow');
                    }, 7000);
                }, 8000); // 1s pause (4+3+1)
            }


            // --- 4. Quiz Tool Logic ---
            const quizForm = document.getElementById('quiz-form');
            const quizResults = document.getElementById('quiz-results');
            const quizScoreText = document.getElementById('quiz-score-text');
            const quizFeedbackText = document.getElementById('quiz-feedback-text');

            quizForm.addEventListener('submit', function(e) {
                e.preventDefault();
                let score = 0;
                const formData = new FormData(quizForm);
                
                for (let value of formData.values()) {
                    score += parseInt(value, 10);
                }

                quizScoreText.textContent = `Your score: ${score} / 9`;

                if (score <= 2) {
                    quizFeedbackText.textContent = "Your stress levels appear to be low. That's great!";
                } else if (score <= 5) {
                    quizFeedbackText.textContent = "You seem to be experiencing mild stress. Remember to take breaks and use tools like the breathing exercise.";
                } else if (score <= 9) {
                    quizFeedbackText.textContent = "Your score indicates moderate to high stress. Please be kind to yourself. Talking about it can help (our AI guide is here), and consider connecting with a professional if this feeling persists.";
                }
                
                quizResults.style.display = 'block';
            });
            
            function resetQuiz() {
                quizForm.reset();
                quizResults.style.display = 'none';
            }


            // --- 5. Journal Tool Logic ---
            const journalEntry = document.getElementById('journal-entry');
            const saveJournalBtn = document.getElementById('saveJournalBtn');
            const journalStatus = document.getElementById('journal-status');

            saveJournalBtn.addEventListener('click', () => {
                localStorage.setItem('mindEaseJournal', journalEntry.value);
                journalStatus.style.display = 'inline';
                setTimeout(() => {
                    journalStatus.style.display = 'none';
                }, 2000);
            });
            
            function loadJournalEntry() {
                const savedEntry = localStorage.getItem('mindEaseJournal');
                if (savedEntry) {
                    journalEntry.value = savedEntry;
                } else {
                    journalEntry.value = ''; // Clear it if no entry
                }
            }

        });
    </script>

</body>

</html>
